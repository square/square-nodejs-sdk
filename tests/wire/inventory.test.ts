// This file was auto-generated by Fern from our API Definition.

import { SquareClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("Inventory", () => {
    test("DeprecatedGetAdjustment", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            adjustment: {
                id: "UDMOEO78BG6GYWA2XDRYX3KB",
                reference_id: "4a366069-4096-47a2-99a5-0084ac879509",
                from_state: "IN_STOCK",
                to_state: "SOLD",
                location_id: "C6W5YS5QM06F5",
                catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                catalog_object_type: "ITEM_VARIATION",
                quantity: "7",
                total_price_money: { amount: BigInt(4550), currency: "USD" },
                occurred_at: "2016-11-16T25:44:22.837Z",
                created_at: "2016-11-17T13:02:15.142Z",
                source: {
                    product: "SQUARE_POS",
                    application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employee_id: "employee_id",
                team_member_id: "LRK57NSQ5X7PUD05",
                transaction_id: "transaction_id",
                refund_id: "refund_id",
                purchase_order_id: "purchase_order_id",
                goods_receipt_id: "goods_receipt_id",
                adjustment_group: {
                    id: "id",
                    root_adjustment_id: "root_adjustment_id",
                    from_state: "CUSTOM",
                    to_state: "CUSTOM",
                },
            },
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/adjustment/adjustment_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.deprecatedGetAdjustment({
            adjustmentId: "adjustment_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            adjustment: {
                id: "UDMOEO78BG6GYWA2XDRYX3KB",
                referenceId: "4a366069-4096-47a2-99a5-0084ac879509",
                fromState: "IN_STOCK",
                toState: "SOLD",
                locationId: "C6W5YS5QM06F5",
                catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                catalogObjectType: "ITEM_VARIATION",
                quantity: "7",
                totalPriceMoney: {
                    amount: BigInt("4550"),
                    currency: "USD",
                },
                occurredAt: "2016-11-16T25:44:22.837Z",
                createdAt: "2016-11-17T13:02:15.142Z",
                source: {
                    product: "SQUARE_POS",
                    applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employeeId: "employee_id",
                teamMemberId: "LRK57NSQ5X7PUD05",
                transactionId: "transaction_id",
                refundId: "refund_id",
                purchaseOrderId: "purchase_order_id",
                goodsReceiptId: "goods_receipt_id",
                adjustmentGroup: {
                    id: "id",
                    rootAdjustmentId: "root_adjustment_id",
                    fromState: "CUSTOM",
                    toState: "CUSTOM",
                },
            },
        });
    });

    test("getAdjustment", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            adjustment: {
                id: "UDMOEO78BG6GYWA2XDRYX3KB",
                reference_id: "4a366069-4096-47a2-99a5-0084ac879509",
                from_state: "IN_STOCK",
                to_state: "SOLD",
                location_id: "C6W5YS5QM06F5",
                catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                catalog_object_type: "ITEM_VARIATION",
                quantity: "7",
                total_price_money: { amount: BigInt(4550), currency: "USD" },
                occurred_at: "2016-11-16T25:44:22.837Z",
                created_at: "2016-11-17T13:02:15.142Z",
                source: {
                    product: "SQUARE_POS",
                    application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employee_id: "employee_id",
                team_member_id: "LRK57NSQ5X7PUD05",
                transaction_id: "transaction_id",
                refund_id: "refund_id",
                purchase_order_id: "purchase_order_id",
                goods_receipt_id: "goods_receipt_id",
                adjustment_group: {
                    id: "id",
                    root_adjustment_id: "root_adjustment_id",
                    from_state: "CUSTOM",
                    to_state: "CUSTOM",
                },
            },
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/adjustments/adjustment_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.getAdjustment({
            adjustmentId: "adjustment_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            adjustment: {
                id: "UDMOEO78BG6GYWA2XDRYX3KB",
                referenceId: "4a366069-4096-47a2-99a5-0084ac879509",
                fromState: "IN_STOCK",
                toState: "SOLD",
                locationId: "C6W5YS5QM06F5",
                catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                catalogObjectType: "ITEM_VARIATION",
                quantity: "7",
                totalPriceMoney: {
                    amount: BigInt("4550"),
                    currency: "USD",
                },
                occurredAt: "2016-11-16T25:44:22.837Z",
                createdAt: "2016-11-17T13:02:15.142Z",
                source: {
                    product: "SQUARE_POS",
                    applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employeeId: "employee_id",
                teamMemberId: "LRK57NSQ5X7PUD05",
                transactionId: "transaction_id",
                refundId: "refund_id",
                purchaseOrderId: "purchase_order_id",
                goodsReceiptId: "goods_receipt_id",
                adjustmentGroup: {
                    id: "id",
                    rootAdjustmentId: "root_adjustment_id",
                    fromState: "CUSTOM",
                    toState: "CUSTOM",
                },
            },
        });
    });

    test("DeprecatedBatchChange", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            idempotency_key: "8fc6a5b0-9fe8-4b46-b46b-2ef95793abbe",
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physical_count: {
                        reference_id: "1536bfbf-efed-48bf-b17d-a197141b2a92",
                        catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                        state: "IN_STOCK",
                        location_id: "C6W5YS5QM06F5",
                        quantity: "53",
                        team_member_id: "LRK57NSQ5X7PUD05",
                        occurred_at: "2016-11-16T22:25:24.878Z",
                    },
                },
            ],
            ignore_unchanged_counts: true,
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            counts: [
                {
                    catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalog_object_type: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    location_id: "C6W5YS5QM06F5",
                    quantity: "53",
                    calculated_at: "2016-11-16T22:28:01.223Z",
                    is_estimated: true,
                },
            ],
            changes: [{ type: "PHYSICAL_COUNT", measurement_unit_id: "measurement_unit_id" }],
        };
        server
            .mockEndpoint()
            .post("/v2/inventory/batch-change")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.deprecatedBatchChange({
            idempotencyKey: "8fc6a5b0-9fe8-4b46-b46b-2ef95793abbe",
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physicalCount: {
                        referenceId: "1536bfbf-efed-48bf-b17d-a197141b2a92",
                        catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                        state: "IN_STOCK",
                        locationId: "C6W5YS5QM06F5",
                        quantity: "53",
                        teamMemberId: "LRK57NSQ5X7PUD05",
                        occurredAt: "2016-11-16T22:25:24.878Z",
                    },
                },
            ],
            ignoreUnchangedCounts: true,
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            counts: [
                {
                    catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalogObjectType: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    locationId: "C6W5YS5QM06F5",
                    quantity: "53",
                    calculatedAt: "2016-11-16T22:28:01.223Z",
                    isEstimated: true,
                },
            ],
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    measurementUnitId: "measurement_unit_id",
                },
            ],
        });
    });

    test("DeprecatedBatchGetChanges", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            catalog_object_ids: ["W62UWFY35CWMYGVWK6TWJDNI"],
            location_ids: ["C6W5YS5QM06F5"],
            types: ["PHYSICAL_COUNT"],
            states: ["IN_STOCK"],
            updated_after: "2016-11-01T00:00:00.000Z",
            updated_before: "2016-12-01T00:00:00.000Z",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physical_count: {
                        id: "46YDTW253DWGGK9HMAE6XCAO",
                        reference_id: "22c07cf4-5626-4224-89f9-691112019399",
                        catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                        catalog_object_type: "ITEM_VARIATION",
                        state: "IN_STOCK",
                        location_id: "C6W5YS5QM06F5",
                        quantity: "86",
                        source: {
                            product: "SQUARE_POS",
                            application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                            name: "Square Point of Sale 4.37",
                        },
                        team_member_id: "LRK57NSQ5X7PUD05",
                        occurred_at: "2016-11-16T22:24:49.028Z",
                        created_at: "2016-11-16T22:25:24.878Z",
                    },
                    measurement_unit_id: "measurement_unit_id",
                },
            ],
            cursor: "cursor",
        };
        server
            .mockEndpoint()
            .post("/v2/inventory/batch-retrieve-changes")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.deprecatedBatchGetChanges({
            catalogObjectIds: ["W62UWFY35CWMYGVWK6TWJDNI"],
            locationIds: ["C6W5YS5QM06F5"],
            types: ["PHYSICAL_COUNT"],
            states: ["IN_STOCK"],
            updatedAfter: "2016-11-01T00:00:00.000Z",
            updatedBefore: "2016-12-01T00:00:00.000Z",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physicalCount: {
                        id: "46YDTW253DWGGK9HMAE6XCAO",
                        referenceId: "22c07cf4-5626-4224-89f9-691112019399",
                        catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                        catalogObjectType: "ITEM_VARIATION",
                        state: "IN_STOCK",
                        locationId: "C6W5YS5QM06F5",
                        quantity: "86",
                        source: {
                            product: "SQUARE_POS",
                            applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                            name: "Square Point of Sale 4.37",
                        },
                        teamMemberId: "LRK57NSQ5X7PUD05",
                        occurredAt: "2016-11-16T22:24:49.028Z",
                        createdAt: "2016-11-16T22:25:24.878Z",
                    },
                    measurementUnitId: "measurement_unit_id",
                },
            ],
            cursor: "cursor",
        });
    });

    test("DeprecatedBatchGetCounts", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            catalog_object_ids: ["W62UWFY35CWMYGVWK6TWJDNI"],
            location_ids: ["59TNP9SA8VGDA"],
            updated_after: "2016-11-16T00:00:00.000Z",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            counts: [
                {
                    catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalog_object_type: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    location_id: "59TNP9SA8VGDA",
                    quantity: "79",
                    calculated_at: "2016-11-16T22:28:01.223Z",
                    is_estimated: true,
                },
            ],
            cursor: "cursor",
        };
        server
            .mockEndpoint()
            .post("/v2/inventory/batch-retrieve-counts")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.deprecatedBatchGetCounts({
            catalogObjectIds: ["W62UWFY35CWMYGVWK6TWJDNI"],
            locationIds: ["59TNP9SA8VGDA"],
            updatedAfter: "2016-11-16T00:00:00.000Z",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            counts: [
                {
                    catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalogObjectType: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    locationId: "59TNP9SA8VGDA",
                    quantity: "79",
                    calculatedAt: "2016-11-16T22:28:01.223Z",
                    isEstimated: true,
                },
            ],
            cursor: "cursor",
        });
    });

    test("BatchCreateChanges", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            idempotency_key: "8fc6a5b0-9fe8-4b46-b46b-2ef95793abbe",
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physical_count: {
                        reference_id: "1536bfbf-efed-48bf-b17d-a197141b2a92",
                        catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                        state: "IN_STOCK",
                        location_id: "C6W5YS5QM06F5",
                        quantity: "53",
                        team_member_id: "LRK57NSQ5X7PUD05",
                        occurred_at: "2016-11-16T22:25:24.878Z",
                    },
                },
            ],
            ignore_unchanged_counts: true,
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            counts: [
                {
                    catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalog_object_type: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    location_id: "C6W5YS5QM06F5",
                    quantity: "53",
                    calculated_at: "2016-11-16T22:28:01.223Z",
                    is_estimated: true,
                },
            ],
            changes: [{ type: "PHYSICAL_COUNT", measurement_unit_id: "measurement_unit_id" }],
        };
        server
            .mockEndpoint()
            .post("/v2/inventory/changes/batch-create")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.batchCreateChanges({
            idempotencyKey: "8fc6a5b0-9fe8-4b46-b46b-2ef95793abbe",
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physicalCount: {
                        referenceId: "1536bfbf-efed-48bf-b17d-a197141b2a92",
                        catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                        state: "IN_STOCK",
                        locationId: "C6W5YS5QM06F5",
                        quantity: "53",
                        teamMemberId: "LRK57NSQ5X7PUD05",
                        occurredAt: "2016-11-16T22:25:24.878Z",
                    },
                },
            ],
            ignoreUnchangedCounts: true,
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            counts: [
                {
                    catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalogObjectType: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    locationId: "C6W5YS5QM06F5",
                    quantity: "53",
                    calculatedAt: "2016-11-16T22:28:01.223Z",
                    isEstimated: true,
                },
            ],
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    measurementUnitId: "measurement_unit_id",
                },
            ],
        });
    });

    test("BatchGetChanges", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            catalog_object_ids: ["W62UWFY35CWMYGVWK6TWJDNI"],
            location_ids: ["C6W5YS5QM06F5"],
            types: ["PHYSICAL_COUNT"],
            states: ["IN_STOCK"],
            updated_after: "2016-11-01T00:00:00.000Z",
            updated_before: "2016-12-01T00:00:00.000Z",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physical_count: {
                        id: "46YDTW253DWGGK9HMAE6XCAO",
                        reference_id: "22c07cf4-5626-4224-89f9-691112019399",
                        catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                        catalog_object_type: "ITEM_VARIATION",
                        state: "IN_STOCK",
                        location_id: "C6W5YS5QM06F5",
                        quantity: "86",
                        source: {
                            product: "SQUARE_POS",
                            application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                            name: "Square Point of Sale 4.37",
                        },
                        team_member_id: "LRK57NSQ5X7PUD05",
                        occurred_at: "2016-11-16T22:24:49.028Z",
                        created_at: "2016-11-16T22:25:24.878Z",
                    },
                    measurement_unit_id: "measurement_unit_id",
                },
            ],
            cursor: "cursor",
        };
        server
            .mockEndpoint()
            .post("/v2/inventory/changes/batch-retrieve")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            changes: [
                {
                    type: "PHYSICAL_COUNT",
                    physicalCount: {
                        id: "46YDTW253DWGGK9HMAE6XCAO",
                        referenceId: "22c07cf4-5626-4224-89f9-691112019399",
                        catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                        catalogObjectType: "ITEM_VARIATION",
                        state: "IN_STOCK",
                        locationId: "C6W5YS5QM06F5",
                        quantity: "86",
                        source: {
                            product: "SQUARE_POS",
                            applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                            name: "Square Point of Sale 4.37",
                        },
                        teamMemberId: "LRK57NSQ5X7PUD05",
                        occurredAt: "2016-11-16T22:24:49.028Z",
                        createdAt: "2016-11-16T22:25:24.878Z",
                    },
                    measurementUnitId: "measurement_unit_id",
                },
            ],
            cursor: "cursor",
        };
        const page = await client.inventory.batchGetChanges({
            catalogObjectIds: ["W62UWFY35CWMYGVWK6TWJDNI"],
            locationIds: ["C6W5YS5QM06F5"],
            types: ["PHYSICAL_COUNT"],
            states: ["IN_STOCK"],
            updatedAfter: "2016-11-01T00:00:00.000Z",
            updatedBefore: "2016-12-01T00:00:00.000Z",
        });

        expect(expected.changes).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.changes).toEqual(nextPage.data);
    });

    test("BatchGetCounts", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            catalog_object_ids: ["W62UWFY35CWMYGVWK6TWJDNI"],
            location_ids: ["59TNP9SA8VGDA"],
            updated_after: "2016-11-16T00:00:00.000Z",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            counts: [
                {
                    catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalog_object_type: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    location_id: "59TNP9SA8VGDA",
                    quantity: "79",
                    calculated_at: "2016-11-16T22:28:01.223Z",
                    is_estimated: true,
                },
            ],
            cursor: "cursor",
        };
        server
            .mockEndpoint()
            .post("/v2/inventory/counts/batch-retrieve")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            counts: [
                {
                    catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalogObjectType: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    locationId: "59TNP9SA8VGDA",
                    quantity: "79",
                    calculatedAt: "2016-11-16T22:28:01.223Z",
                    isEstimated: true,
                },
            ],
            cursor: "cursor",
        };
        const page = await client.inventory.batchGetCounts({
            catalogObjectIds: ["W62UWFY35CWMYGVWK6TWJDNI"],
            locationIds: ["59TNP9SA8VGDA"],
            updatedAfter: "2016-11-16T00:00:00.000Z",
        });

        expect(expected.counts).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.counts).toEqual(nextPage.data);
    });

    test("deprecatedGetPhysicalCount", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            count: {
                id: "ANZADNPLKADOJKJIUANKLMLQ",
                reference_id: "f857ec37-f9a0-4458-8e23-5b5e0bea4e53",
                catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                catalog_object_type: "ITEM_VARIATION",
                state: "IN_STOCK",
                location_id: "C6W5YS5QM06F5",
                quantity: "15",
                source: {
                    product: "SQUARE_POS",
                    application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employee_id: "employee_id",
                team_member_id: "LRK57NSQ5X7PUD05",
                occurred_at: "2016-11-16T22:25:24.878Z",
                created_at: "2016-11-16T22:25:24.878Z",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/physical-count/physical_count_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.deprecatedGetPhysicalCount({
            physicalCountId: "physical_count_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            count: {
                id: "ANZADNPLKADOJKJIUANKLMLQ",
                referenceId: "f857ec37-f9a0-4458-8e23-5b5e0bea4e53",
                catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                catalogObjectType: "ITEM_VARIATION",
                state: "IN_STOCK",
                locationId: "C6W5YS5QM06F5",
                quantity: "15",
                source: {
                    product: "SQUARE_POS",
                    applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employeeId: "employee_id",
                teamMemberId: "LRK57NSQ5X7PUD05",
                occurredAt: "2016-11-16T22:25:24.878Z",
                createdAt: "2016-11-16T22:25:24.878Z",
            },
        });
    });

    test("getPhysicalCount", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            count: {
                id: "ANZADNPLKADOJKJIUANKLMLQ",
                reference_id: "f857ec37-f9a0-4458-8e23-5b5e0bea4e53",
                catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                catalog_object_type: "ITEM_VARIATION",
                state: "IN_STOCK",
                location_id: "C6W5YS5QM06F5",
                quantity: "15",
                source: {
                    product: "SQUARE_POS",
                    application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employee_id: "employee_id",
                team_member_id: "LRK57NSQ5X7PUD05",
                occurred_at: "2016-11-16T22:25:24.878Z",
                created_at: "2016-11-16T22:25:24.878Z",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/physical-counts/physical_count_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.getPhysicalCount({
            physicalCountId: "physical_count_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            count: {
                id: "ANZADNPLKADOJKJIUANKLMLQ",
                referenceId: "f857ec37-f9a0-4458-8e23-5b5e0bea4e53",
                catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                catalogObjectType: "ITEM_VARIATION",
                state: "IN_STOCK",
                locationId: "C6W5YS5QM06F5",
                quantity: "15",
                source: {
                    product: "SQUARE_POS",
                    applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employeeId: "employee_id",
                teamMemberId: "LRK57NSQ5X7PUD05",
                occurredAt: "2016-11-16T22:25:24.878Z",
                createdAt: "2016-11-16T22:25:24.878Z",
            },
        });
    });

    test("getTransfer", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            transfer: {
                id: "UDMOEO78BG6GYWA2XDRYX3KB",
                reference_id: "4a366069-4096-47a2-99a5-0084ac879509",
                state: "IN_STOCK",
                from_location_id: "C6W5YS5QM06F5",
                to_location_id: "59TNP9SA8VGDA",
                catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                catalog_object_type: "ITEM_VARIATION",
                quantity: "7",
                occurred_at: "2016-11-16T25:44:22.837Z",
                created_at: "2016-11-17T13:02:15.142Z",
                source: {
                    product: "SQUARE_POS",
                    application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employee_id: "employee_id",
                team_member_id: "LRK57NSQ5X7PUD05",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/transfers/transfer_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.inventory.getTransfer({
            transferId: "transfer_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            transfer: {
                id: "UDMOEO78BG6GYWA2XDRYX3KB",
                referenceId: "4a366069-4096-47a2-99a5-0084ac879509",
                state: "IN_STOCK",
                fromLocationId: "C6W5YS5QM06F5",
                toLocationId: "59TNP9SA8VGDA",
                catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                catalogObjectType: "ITEM_VARIATION",
                quantity: "7",
                occurredAt: "2016-11-16T25:44:22.837Z",
                createdAt: "2016-11-17T13:02:15.142Z",
                source: {
                    product: "SQUARE_POS",
                    applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                    name: "Square Point of Sale 4.37",
                },
                employeeId: "employee_id",
                teamMemberId: "LRK57NSQ5X7PUD05",
            },
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            counts: [
                {
                    catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalog_object_type: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    location_id: "C6W5YS5QM06F5",
                    quantity: "22",
                    calculated_at: "2016-11-16T22:28:01.223Z",
                    is_estimated: true,
                },
            ],
            cursor: "cursor",
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/catalog_object_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            counts: [
                {
                    catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                    catalogObjectType: "ITEM_VARIATION",
                    state: "IN_STOCK",
                    locationId: "C6W5YS5QM06F5",
                    quantity: "22",
                    calculatedAt: "2016-11-16T22:28:01.223Z",
                    isEstimated: true,
                },
            ],
            cursor: "cursor",
        };
        const page = await client.inventory.get({
            catalogObjectId: "catalog_object_id",
            locationIds: "location_ids",
            cursor: "cursor",
        });

        expect(expected.counts).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.counts).toEqual(nextPage.data);
    });

    test("changes", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            changes: [
                {
                    type: "ADJUSTMENT",
                    adjustment: {
                        id: "OJKJIUANKLMLQANZADNPLKAD",
                        reference_id: "d8207693-168f-4b44-a2fd-a7ff533ddd26",
                        from_state: "IN_STOCK",
                        to_state: "SOLD",
                        location_id: "C6W5YS5QM06F5",
                        catalog_object_id: "W62UWFY35CWMYGVWK6TWJDNI",
                        catalog_object_type: "ITEM_VARIATION",
                        quantity: "3",
                        total_price_money: { amount: BigInt(5000), currency: "USD" },
                        occurred_at: "2016-11-16T22:25:24.878Z",
                        created_at: "2016-11-16T22:25:24.878Z",
                        source: {
                            product: "SQUARE_POS",
                            application_id: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                            name: "Square Point of Sale 4.37",
                        },
                        team_member_id: "AV7YRCGI2H1J5NQ8E1XIZCNA",
                        transaction_id: "5APV6JYK1SNCZD11AND2RX1Z",
                    },
                    measurement_unit_id: "measurement_unit_id",
                },
            ],
            cursor: "cursor",
        };
        server
            .mockEndpoint()
            .get("/v2/inventory/catalog_object_id/changes")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            changes: [
                {
                    type: "ADJUSTMENT",
                    adjustment: {
                        id: "OJKJIUANKLMLQANZADNPLKAD",
                        referenceId: "d8207693-168f-4b44-a2fd-a7ff533ddd26",
                        fromState: "IN_STOCK",
                        toState: "SOLD",
                        locationId: "C6W5YS5QM06F5",
                        catalogObjectId: "W62UWFY35CWMYGVWK6TWJDNI",
                        catalogObjectType: "ITEM_VARIATION",
                        quantity: "3",
                        totalPriceMoney: {
                            amount: BigInt("5000"),
                            currency: "USD",
                        },
                        occurredAt: "2016-11-16T22:25:24.878Z",
                        createdAt: "2016-11-16T22:25:24.878Z",
                        source: {
                            product: "SQUARE_POS",
                            applicationId: "416ff29c-86c4-4feb-b58c-9705f21f3ea0",
                            name: "Square Point of Sale 4.37",
                        },
                        teamMemberId: "AV7YRCGI2H1J5NQ8E1XIZCNA",
                        transactionId: "5APV6JYK1SNCZD11AND2RX1Z",
                    },
                    measurementUnitId: "measurement_unit_id",
                },
            ],
            cursor: "cursor",
        };
        const page = await client.inventory.changes({
            catalogObjectId: "catalog_object_id",
            locationIds: "location_ids",
            cursor: "cursor",
        });

        expect(expected.changes).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.changes).toEqual(nextPage.data);
    });
});
