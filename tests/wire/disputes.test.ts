// This file was auto-generated by Fern from our API Definition.

import { SquareClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("Disputes", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            disputes: [
                {
                    dispute_id: "dispute_id",
                    id: "XDgyFu7yo1E2S5lQGGpYn",
                    amount_money: { amount: BigInt(2500), currency: "USD" },
                    reason: "NO_KNOWLEDGE",
                    state: "ACCEPTED",
                    due_at: "2022-07-13T00:00:00.000Z",
                    disputed_payment: { payment_id: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY" },
                    evidence_ids: ["evidence_ids"],
                    card_brand: "VISA",
                    created_at: "2022-06-29T18:45:22.265Z",
                    updated_at: "2022-07-07T19:14:42.650Z",
                    brand_dispute_id: "100000809947",
                    reported_date: "reported_date",
                    reported_at: "2022-06-29T00:00:00.000Z",
                    version: 2,
                    location_id: "L1HN3ZMQK64X9",
                },
                {
                    dispute_id: "dispute_id",
                    id: "jLGg7aXC7lvKPr9PISt0T",
                    amount_money: { amount: BigInt(2209), currency: "USD" },
                    reason: "NOT_AS_DESCRIBED",
                    state: "EVIDENCE_REQUIRED",
                    due_at: "2022-05-13T00:00:00.000Z",
                    disputed_payment: { payment_id: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY" },
                    evidence_ids: ["evidence_ids"],
                    card_brand: "VISA",
                    created_at: "2022-04-29T18:45:22.265Z",
                    updated_at: "2022-04-29T18:45:22.265Z",
                    brand_dispute_id: "r5Of6YaGT7AdeRaVoAGCJw",
                    reported_date: "reported_date",
                    reported_at: "2022-04-29T00:00:00.000Z",
                    version: 1,
                    location_id: "18YC4JDH91E1H",
                },
            ],
            cursor: "G1aSTRm48CLjJsg6Sg3hQN1b1OMaoVuG",
        };
        server.mockEndpoint().get("/v2/disputes").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            disputes: [
                {
                    disputeId: "dispute_id",
                    id: "XDgyFu7yo1E2S5lQGGpYn",
                    amountMoney: {
                        amount: BigInt("2500"),
                        currency: "USD",
                    },
                    reason: "NO_KNOWLEDGE",
                    state: "ACCEPTED",
                    dueAt: "2022-07-13T00:00:00.000Z",
                    disputedPayment: {
                        paymentId: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY",
                    },
                    evidenceIds: ["evidence_ids"],
                    cardBrand: "VISA",
                    createdAt: "2022-06-29T18:45:22.265Z",
                    updatedAt: "2022-07-07T19:14:42.650Z",
                    brandDisputeId: "100000809947",
                    reportedDate: "reported_date",
                    reportedAt: "2022-06-29T00:00:00.000Z",
                    version: 2,
                    locationId: "L1HN3ZMQK64X9",
                },
                {
                    disputeId: "dispute_id",
                    id: "jLGg7aXC7lvKPr9PISt0T",
                    amountMoney: {
                        amount: BigInt("2209"),
                        currency: "USD",
                    },
                    reason: "NOT_AS_DESCRIBED",
                    state: "EVIDENCE_REQUIRED",
                    dueAt: "2022-05-13T00:00:00.000Z",
                    disputedPayment: {
                        paymentId: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY",
                    },
                    evidenceIds: ["evidence_ids"],
                    cardBrand: "VISA",
                    createdAt: "2022-04-29T18:45:22.265Z",
                    updatedAt: "2022-04-29T18:45:22.265Z",
                    brandDisputeId: "r5Of6YaGT7AdeRaVoAGCJw",
                    reportedDate: "reported_date",
                    reportedAt: "2022-04-29T00:00:00.000Z",
                    version: 1,
                    locationId: "18YC4JDH91E1H",
                },
            ],
            cursor: "G1aSTRm48CLjJsg6Sg3hQN1b1OMaoVuG",
        };
        const page = await client.disputes.list({
            cursor: "cursor",
            states: "INQUIRY_EVIDENCE_REQUIRED",
            locationId: "location_id",
        });

        expect(expected.disputes).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.disputes).toEqual(nextPage.data);
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            dispute: {
                dispute_id: "dispute_id",
                id: "XDgyFu7yo1E2S5lQGGpYn",
                amount_money: { amount: BigInt(2500), currency: "USD" },
                reason: "NO_KNOWLEDGE",
                state: "ACCEPTED",
                due_at: "2022-07-13T00:00:00.000Z",
                disputed_payment: { payment_id: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY" },
                evidence_ids: ["evidence_ids"],
                card_brand: "VISA",
                created_at: "2022-06-29T18:45:22.265Z",
                updated_at: "2022-07-07T19:14:42.650Z",
                brand_dispute_id: "100000809947",
                reported_date: "reported_date",
                reported_at: "2022-06-29T00:00:00.000Z",
                version: 2,
                location_id: "L1HN3ZMQK64X9",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/disputes/dispute_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.disputes.get({
            disputeId: "dispute_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            dispute: {
                disputeId: "dispute_id",
                id: "XDgyFu7yo1E2S5lQGGpYn",
                amountMoney: {
                    amount: BigInt("2500"),
                    currency: "USD",
                },
                reason: "NO_KNOWLEDGE",
                state: "ACCEPTED",
                dueAt: "2022-07-13T00:00:00.000Z",
                disputedPayment: {
                    paymentId: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY",
                },
                evidenceIds: ["evidence_ids"],
                cardBrand: "VISA",
                createdAt: "2022-06-29T18:45:22.265Z",
                updatedAt: "2022-07-07T19:14:42.650Z",
                brandDisputeId: "100000809947",
                reportedDate: "reported_date",
                reportedAt: "2022-06-29T00:00:00.000Z",
                version: 2,
                locationId: "L1HN3ZMQK64X9",
            },
        });
    });

    test("accept", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            dispute: {
                dispute_id: "dispute_id",
                id: "XDgyFu7yo1E2S5lQGGpYn",
                amount_money: { amount: BigInt(2500), currency: "USD" },
                reason: "NO_KNOWLEDGE",
                state: "ACCEPTED",
                due_at: "2022-07-13T00:00:00.000Z",
                disputed_payment: { payment_id: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY" },
                evidence_ids: ["evidence_ids"],
                card_brand: "VISA",
                created_at: "2022-06-29T18:45:22.265Z",
                updated_at: "2022-07-07T19:14:42.650Z",
                brand_dispute_id: "100000809947",
                reported_date: "reported_date",
                reported_at: "2022-06-29T00:00:00.000Z",
                version: 2,
                location_id: "L1HN3ZMQK64X9",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/disputes/dispute_id/accept")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.disputes.accept({
            disputeId: "dispute_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            dispute: {
                disputeId: "dispute_id",
                id: "XDgyFu7yo1E2S5lQGGpYn",
                amountMoney: {
                    amount: BigInt("2500"),
                    currency: "USD",
                },
                reason: "NO_KNOWLEDGE",
                state: "ACCEPTED",
                dueAt: "2022-07-13T00:00:00.000Z",
                disputedPayment: {
                    paymentId: "zhyh1ch64kRBrrlfVhwjCEjZWzNZY",
                },
                evidenceIds: ["evidence_ids"],
                cardBrand: "VISA",
                createdAt: "2022-06-29T18:45:22.265Z",
                updatedAt: "2022-07-07T19:14:42.650Z",
                brandDisputeId: "100000809947",
                reportedDate: "reported_date",
                reportedAt: "2022-06-29T00:00:00.000Z",
                version: 2,
                locationId: "L1HN3ZMQK64X9",
            },
        });
    });

    test("CreateEvidenceText", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            idempotency_key: "ed3ee3933d946f1514d505d173c82648",
            evidence_type: "TRACKING_NUMBER",
            evidence_text: "1Z8888888888888888",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            evidence: {
                evidence_id: "evidence_id",
                id: "TOomLInj6iWmP3N8qfCXrB",
                dispute_id: "bVTprrwk0gygTLZ96VX1oB",
                evidence_file: { filename: "filename", filetype: "filetype" },
                evidence_text: "The customer purchased the item twice, on April 11 and April 28.",
                uploaded_at: "2022-05-18T16:01:10.000Z",
                evidence_type: "REBUTTAL_EXPLANATION",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/disputes/dispute_id/evidence-text")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.disputes.createEvidenceText({
            disputeId: "dispute_id",
            idempotencyKey: "ed3ee3933d946f1514d505d173c82648",
            evidenceType: "TRACKING_NUMBER",
            evidenceText: "1Z8888888888888888",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            evidence: {
                evidenceId: "evidence_id",
                id: "TOomLInj6iWmP3N8qfCXrB",
                disputeId: "bVTprrwk0gygTLZ96VX1oB",
                evidenceFile: {
                    filename: "filename",
                    filetype: "filetype",
                },
                evidenceText: "The customer purchased the item twice, on April 11 and April 28.",
                uploadedAt: "2022-05-18T16:01:10.000Z",
                evidenceType: "REBUTTAL_EXPLANATION",
            },
        });
    });

    test("SubmitEvidence", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            dispute: {
                dispute_id: "dispute_id",
                id: "EAZoK70gX3fyvibecLwIGB",
                amount_money: { amount: BigInt(4350), currency: "USD" },
                reason: "CUSTOMER_REQUESTS_CREDIT",
                state: "PROCESSING",
                due_at: "2022-06-01T00:00:00.000Z",
                disputed_payment: { payment_id: "2yeBUWJzllJTpmnSqtMRAL19taB" },
                evidence_ids: ["evidence_ids"],
                card_brand: "VISA",
                created_at: "2022-05-18T16:02:15.313Z",
                updated_at: "2022-05-18T16:02:15.313Z",
                brand_dispute_id: "100000399240",
                reported_date: "reported_date",
                reported_at: "2022-05-18T00:00:00.000Z",
                version: 4,
                location_id: "LSY8XKGSMMX94",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/disputes/dispute_id/submit-evidence")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.disputes.submitEvidence({
            disputeId: "dispute_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            dispute: {
                disputeId: "dispute_id",
                id: "EAZoK70gX3fyvibecLwIGB",
                amountMoney: {
                    amount: BigInt("4350"),
                    currency: "USD",
                },
                reason: "CUSTOMER_REQUESTS_CREDIT",
                state: "PROCESSING",
                dueAt: "2022-06-01T00:00:00.000Z",
                disputedPayment: {
                    paymentId: "2yeBUWJzllJTpmnSqtMRAL19taB",
                },
                evidenceIds: ["evidence_ids"],
                cardBrand: "VISA",
                createdAt: "2022-05-18T16:02:15.313Z",
                updatedAt: "2022-05-18T16:02:15.313Z",
                brandDisputeId: "100000399240",
                reportedDate: "reported_date",
                reportedAt: "2022-05-18T00:00:00.000Z",
                version: 4,
                locationId: "LSY8XKGSMMX94",
            },
        });
    });
});
