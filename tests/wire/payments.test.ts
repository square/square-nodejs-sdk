// This file was auto-generated by Fern from our API Definition.

import { SquareClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("Payments", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            payments: [
                {
                    id: "bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                    created_at: "2021-10-13T19:34:33.524Z",
                    updated_at: "2021-10-13T19:34:37.261Z",
                    amount_money: { amount: BigInt(555), currency: "USD" },
                    total_money: { amount: BigInt(555), currency: "USD" },
                    approved_money: { amount: BigInt(555), currency: "USD" },
                    processing_fee: [
                        {
                            effective_at: "2021-10-13T21:34:35.000Z",
                            type: "INITIAL",
                            amount_money: { amount: BigInt(34), currency: "USD" },
                        },
                    ],
                    status: "COMPLETED",
                    delay_duration: "PT168H",
                    delay_action: "CANCEL",
                    delayed_until: "2021-10-20T19:34:33.524Z",
                    source_type: "CARD",
                    card_details: {
                        status: "CAPTURED",
                        card: {
                            card_brand: "VISA",
                            last_4: "1111",
                            exp_month: BigInt(11),
                            exp_year: BigInt(2022),
                            fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                            card_type: "DEBIT",
                            prepaid_type: "NOT_PREPAID",
                            bin: "411111",
                        },
                        entry_method: "KEYED",
                        cvv_status: "CVV_ACCEPTED",
                        avs_status: "AVS_ACCEPTED",
                        auth_result_code: "2Nkw7q",
                        statement_description: "SQ *EXAMPLE TEST GOSQ.C",
                        card_payment_timeline: {
                            authorized_at: "2021-10-13T19:34:33.680Z",
                            captured_at: "2021-10-13T19:34:34.340Z",
                        },
                    },
                    cash_details: { buyer_supplied_money: {} },
                    external_details: { type: "type", source: "source" },
                    location_id: "L88917AVBK2S5",
                    order_id: "d7eKah653Z579f3gVtjlxpSlmUcZY",
                    reference_id: "reference_id",
                    customer_id: "customer_id",
                    employee_id: "TMoK_ogh6rH1o4dV",
                    team_member_id: "TMoK_ogh6rH1o4dV",
                    refund_ids: ["refund_ids"],
                    terminal_checkout_id: "terminal_checkout_id",
                    buyer_email_address: "buyer_email_address",
                    note: "Test Note",
                    statement_description_identifier: "statement_description_identifier",
                    capabilities: ["capabilities"],
                    receipt_number: "bP9m",
                    receipt_url: "https://squareup.com/receipt/preview/bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                    application_details: {
                        square_product: "VIRTUAL_TERMINAL",
                        application_id: "sq0ids-Pw67AZAlLVB7hsRmwlJPuA",
                    },
                    is_offline_payment: true,
                    version_token: "vguW2km0KpVCdAXZcNTZ438qg5LlVPTP4HO5OpiHNfa6o",
                },
            ],
            cursor: "cursor",
        };
        server.mockEndpoint().get("/v2/payments").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            payments: [
                {
                    id: "bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                    createdAt: "2021-10-13T19:34:33.524Z",
                    updatedAt: "2021-10-13T19:34:37.261Z",
                    amountMoney: {
                        amount: BigInt("555"),
                        currency: "USD",
                    },
                    totalMoney: {
                        amount: BigInt("555"),
                        currency: "USD",
                    },
                    approvedMoney: {
                        amount: BigInt("555"),
                        currency: "USD",
                    },
                    processingFee: [
                        {
                            effectiveAt: "2021-10-13T21:34:35.000Z",
                            type: "INITIAL",
                            amountMoney: {
                                amount: BigInt("34"),
                                currency: "USD",
                            },
                        },
                    ],
                    status: "COMPLETED",
                    delayDuration: "PT168H",
                    delayAction: "CANCEL",
                    delayedUntil: "2021-10-20T19:34:33.524Z",
                    sourceType: "CARD",
                    cardDetails: {
                        status: "CAPTURED",
                        card: {
                            cardBrand: "VISA",
                            last4: "1111",
                            expMonth: BigInt("11"),
                            expYear: BigInt("2022"),
                            fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                            cardType: "DEBIT",
                            prepaidType: "NOT_PREPAID",
                            bin: "411111",
                        },
                        entryMethod: "KEYED",
                        cvvStatus: "CVV_ACCEPTED",
                        avsStatus: "AVS_ACCEPTED",
                        authResultCode: "2Nkw7q",
                        statementDescription: "SQ *EXAMPLE TEST GOSQ.C",
                        cardPaymentTimeline: {
                            authorizedAt: "2021-10-13T19:34:33.680Z",
                            capturedAt: "2021-10-13T19:34:34.340Z",
                        },
                    },
                    cashDetails: {
                        buyerSuppliedMoney: {},
                    },
                    externalDetails: {
                        type: "type",
                        source: "source",
                    },
                    locationId: "L88917AVBK2S5",
                    orderId: "d7eKah653Z579f3gVtjlxpSlmUcZY",
                    referenceId: "reference_id",
                    customerId: "customer_id",
                    employeeId: "TMoK_ogh6rH1o4dV",
                    teamMemberId: "TMoK_ogh6rH1o4dV",
                    refundIds: ["refund_ids"],
                    terminalCheckoutId: "terminal_checkout_id",
                    buyerEmailAddress: "buyer_email_address",
                    note: "Test Note",
                    statementDescriptionIdentifier: "statement_description_identifier",
                    capabilities: ["capabilities"],
                    receiptNumber: "bP9m",
                    receiptUrl: "https://squareup.com/receipt/preview/bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                    applicationDetails: {
                        squareProduct: "VIRTUAL_TERMINAL",
                        applicationId: "sq0ids-Pw67AZAlLVB7hsRmwlJPuA",
                    },
                    isOfflinePayment: true,
                    versionToken: "vguW2km0KpVCdAXZcNTZ438qg5LlVPTP4HO5OpiHNfa6o",
                },
            ],
            cursor: "cursor",
        };
        const page = await client.payments.list({
            beginTime: "begin_time",
            endTime: "end_time",
            sortOrder: "sort_order",
            cursor: "cursor",
            locationId: "location_id",
            total: BigInt("1000000"),
            last4: "last_4",
            cardBrand: "card_brand",
            limit: 1,
            isOfflinePayment: true,
            offlineBeginTime: "offline_begin_time",
            offlineEndTime: "offline_end_time",
            updatedAtBeginTime: "updated_at_begin_time",
            updatedAtEndTime: "updated_at_end_time",
            sortField: "CREATED_AT",
        });

        expect(expected.payments).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.payments).toEqual(nextPage.data);
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            source_id: "ccof:GaJGNaZa8x4OgDJn4GB",
            idempotency_key: "7b0f3ec5-086a-4871-8f13-3c81b3875218",
            amount_money: { amount: BigInt(1000), currency: "USD" },
            app_fee_money: { amount: BigInt(10), currency: "USD" },
            autocomplete: true,
            customer_id: "W92WH6P11H4Z77CTET0RNTGFW8",
            location_id: "L88917AVBK2S5",
            reference_id: "123456",
            note: "Brief description",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            payment: {
                id: "R2B3Z8WMVt3EAmzYWLZvz7Y69EbZY",
                created_at: "2021-10-13T21:14:29.577Z",
                updated_at: "2021-10-13T21:14:30.504Z",
                amount_money: { amount: BigInt(1000), currency: "USD" },
                tip_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                total_money: { amount: BigInt(1000), currency: "USD" },
                app_fee_money: { amount: BigInt(10), currency: "USD" },
                approved_money: { amount: BigInt(1000), currency: "USD" },
                processing_fee: [{}],
                refunded_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                status: "COMPLETED",
                delay_duration: "PT168H",
                delay_action: "CANCEL",
                delayed_until: "2021-10-20T21:14:29.577Z",
                source_type: "CARD",
                card_details: {
                    status: "CAPTURED",
                    card: {
                        card_brand: "VISA",
                        last_4: "1111",
                        exp_month: BigInt(11),
                        exp_year: BigInt(2022),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        card_type: "DEBIT",
                        prepaid_type: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entry_method: "ON_FILE",
                    cvv_status: "CVV_ACCEPTED",
                    avs_status: "AVS_ACCEPTED",
                    auth_result_code: "vNEn2f",
                    application_identifier: "application_identifier",
                    application_name: "application_name",
                    application_cryptogram: "application_cryptogram",
                    verification_method: "verification_method",
                    verification_results: "verification_results",
                    statement_description: "SQ *EXAMPLE TEST GOSQ.C",
                    card_payment_timeline: {
                        authorized_at: "2021-10-13T21:14:29.732Z",
                        captured_at: "2021-10-13T21:14:30.504Z",
                    },
                    refund_requires_card_presence: true,
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                cash_details: { buyer_supplied_money: {} },
                bank_account_details: {
                    bank_name: "bank_name",
                    transfer_type: "transfer_type",
                    account_ownership_type: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statement_description: "statement_description",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                external_details: { type: "type", source: "source", source_id: "source_id" },
                wallet_details: { status: "status", brand: "brand" },
                buy_now_pay_later_details: { brand: "brand" },
                square_account_details: {
                    payment_source_token: "payment_source_token",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                location_id: "L88917AVBK2S5",
                order_id: "pRsjRTgFWATl7so6DxdKBJa7ssbZY",
                reference_id: "123456",
                customer_id: "W92WH6P11H4Z77CTET0RNTGFW8",
                employee_id: "employee_id",
                team_member_id: "team_member_id",
                refund_ids: ["refund_ids"],
                risk_evaluation: { created_at: "2021-10-13T21:14:30.423Z", risk_level: "NORMAL" },
                terminal_checkout_id: "terminal_checkout_id",
                buyer_email_address: "buyer_email_address",
                billing_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                shipping_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                note: "Brief Description",
                statement_description_identifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receipt_number: "R2B3",
                receipt_url: "https://squareup.com/receipt/preview/EXAMPLE_RECEIPT_ID",
                device_details: {
                    device_id: "device_id",
                    device_installation_id: "device_installation_id",
                    device_name: "device_name",
                },
                application_details: {
                    square_product: "ECOMMERCE_API",
                    application_id: "sq0ids-TcgftTEtKxJTRF1lCFJ9TA",
                },
                is_offline_payment: true,
                offline_payment_details: { client_created_at: "client_created_at" },
                version_token: "TPtNEOBOa6Qq6E3C3IjckSVOM6b3hMbfhjvTxHBQUsB6o",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/payments")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.create({
            sourceId: "ccof:GaJGNaZa8x4OgDJn4GB",
            idempotencyKey: "7b0f3ec5-086a-4871-8f13-3c81b3875218",
            amountMoney: {
                amount: BigInt("1000"),
                currency: "USD",
            },
            appFeeMoney: {
                amount: BigInt("10"),
                currency: "USD",
            },
            autocomplete: true,
            customerId: "W92WH6P11H4Z77CTET0RNTGFW8",
            locationId: "L88917AVBK2S5",
            referenceId: "123456",
            note: "Brief description",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            payment: {
                id: "R2B3Z8WMVt3EAmzYWLZvz7Y69EbZY",
                createdAt: "2021-10-13T21:14:29.577Z",
                updatedAt: "2021-10-13T21:14:30.504Z",
                amountMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                tipMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                totalMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                appFeeMoney: {
                    amount: BigInt("10"),
                    currency: "USD",
                },
                approvedMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                processingFee: [{}],
                refundedMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                status: "COMPLETED",
                delayDuration: "PT168H",
                delayAction: "CANCEL",
                delayedUntil: "2021-10-20T21:14:29.577Z",
                sourceType: "CARD",
                cardDetails: {
                    status: "CAPTURED",
                    card: {
                        cardBrand: "VISA",
                        last4: "1111",
                        expMonth: BigInt("11"),
                        expYear: BigInt("2022"),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        cardType: "DEBIT",
                        prepaidType: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entryMethod: "ON_FILE",
                    cvvStatus: "CVV_ACCEPTED",
                    avsStatus: "AVS_ACCEPTED",
                    authResultCode: "vNEn2f",
                    applicationIdentifier: "application_identifier",
                    applicationName: "application_name",
                    applicationCryptogram: "application_cryptogram",
                    verificationMethod: "verification_method",
                    verificationResults: "verification_results",
                    statementDescription: "SQ *EXAMPLE TEST GOSQ.C",
                    cardPaymentTimeline: {
                        authorizedAt: "2021-10-13T21:14:29.732Z",
                        capturedAt: "2021-10-13T21:14:30.504Z",
                    },
                    refundRequiresCardPresence: true,
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                cashDetails: {
                    buyerSuppliedMoney: {},
                },
                bankAccountDetails: {
                    bankName: "bank_name",
                    transferType: "transfer_type",
                    accountOwnershipType: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statementDescription: "statement_description",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                externalDetails: {
                    type: "type",
                    source: "source",
                    sourceId: "source_id",
                },
                walletDetails: {
                    status: "status",
                    brand: "brand",
                },
                buyNowPayLaterDetails: {
                    brand: "brand",
                },
                squareAccountDetails: {
                    paymentSourceToken: "payment_source_token",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                locationId: "L88917AVBK2S5",
                orderId: "pRsjRTgFWATl7so6DxdKBJa7ssbZY",
                referenceId: "123456",
                customerId: "W92WH6P11H4Z77CTET0RNTGFW8",
                employeeId: "employee_id",
                teamMemberId: "team_member_id",
                refundIds: ["refund_ids"],
                riskEvaluation: {
                    createdAt: "2021-10-13T21:14:30.423Z",
                    riskLevel: "NORMAL",
                },
                terminalCheckoutId: "terminal_checkout_id",
                buyerEmailAddress: "buyer_email_address",
                billingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                shippingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                note: "Brief Description",
                statementDescriptionIdentifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receiptNumber: "R2B3",
                receiptUrl: "https://squareup.com/receipt/preview/EXAMPLE_RECEIPT_ID",
                deviceDetails: {
                    deviceId: "device_id",
                    deviceInstallationId: "device_installation_id",
                    deviceName: "device_name",
                },
                applicationDetails: {
                    squareProduct: "ECOMMERCE_API",
                    applicationId: "sq0ids-TcgftTEtKxJTRF1lCFJ9TA",
                },
                isOfflinePayment: true,
                offlinePaymentDetails: {
                    clientCreatedAt: "client_created_at",
                },
                versionToken: "TPtNEOBOa6Qq6E3C3IjckSVOM6b3hMbfhjvTxHBQUsB6o",
            },
        });
    });

    test("cancelByIdempotencyKey", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = { idempotency_key: "a7e36d40-d24b-11e8-b568-0800200c9a66" };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
        };
        server
            .mockEndpoint()
            .post("/v2/payments/cancel")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.cancelByIdempotencyKey({
            idempotencyKey: "a7e36d40-d24b-11e8-b568-0800200c9a66",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            payment: {
                id: "bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                created_at: "2021-10-13T19:34:33.524Z",
                updated_at: "2021-10-13T19:34:34.339Z",
                amount_money: { amount: BigInt(555), currency: "USD" },
                tip_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                total_money: { amount: BigInt(555), currency: "USD" },
                app_fee_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                approved_money: { amount: BigInt(555), currency: "USD" },
                processing_fee: [
                    {
                        effective_at: "2021-10-13T21:34:35.000Z",
                        type: "INITIAL",
                        amount_money: { amount: BigInt(34), currency: "USD" },
                    },
                ],
                refunded_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                status: "COMPLETED",
                delay_duration: "PT168H",
                delay_action: "CANCEL",
                delayed_until: "2021-10-20T19:34:33.524Z",
                source_type: "CARD",
                card_details: {
                    status: "CAPTURED",
                    card: {
                        card_brand: "VISA",
                        last_4: "1111",
                        exp_month: BigInt(11),
                        exp_year: BigInt(2022),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        card_type: "DEBIT",
                        prepaid_type: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entry_method: "KEYED",
                    cvv_status: "CVV_ACCEPTED",
                    avs_status: "AVS_ACCEPTED",
                    auth_result_code: "2Nkw7q",
                    application_identifier: "application_identifier",
                    application_name: "application_name",
                    application_cryptogram: "application_cryptogram",
                    verification_method: "verification_method",
                    verification_results: "verification_results",
                    statement_description: "SQ *EXAMPLE TEST GOSQ.C",
                    card_payment_timeline: {
                        authorized_at: "2021-10-13T19:34:33.680Z",
                        captured_at: "2021-10-13T19:34:34.340Z",
                    },
                    refund_requires_card_presence: true,
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                cash_details: { buyer_supplied_money: {} },
                bank_account_details: {
                    bank_name: "bank_name",
                    transfer_type: "transfer_type",
                    account_ownership_type: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statement_description: "statement_description",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                external_details: { type: "type", source: "source", source_id: "source_id" },
                wallet_details: { status: "status", brand: "brand" },
                buy_now_pay_later_details: { brand: "brand" },
                square_account_details: {
                    payment_source_token: "payment_source_token",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                location_id: "L88917AVBK2S5",
                order_id: "d7eKah653Z579f3gVtjlxpSlmUcZY",
                reference_id: "reference_id",
                customer_id: "customer_id",
                employee_id: "TMoK_ogh6rH1o4dV",
                team_member_id: "TMoK_ogh6rH1o4dV",
                refund_ids: ["refund_ids"],
                risk_evaluation: { created_at: "created_at", risk_level: "PENDING" },
                terminal_checkout_id: "terminal_checkout_id",
                buyer_email_address: "buyer_email_address",
                billing_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                shipping_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                note: "Test Note",
                statement_description_identifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receipt_number: "bP9m",
                receipt_url: "https://squareup.com/receipt/preview/bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                device_details: {
                    device_id: "device_id",
                    device_installation_id: "device_installation_id",
                    device_name: "device_name",
                },
                application_details: {
                    square_product: "VIRTUAL_TERMINAL",
                    application_id: "sq0ids-Pw67AZAlLVB7hsRmwlJPuA",
                },
                is_offline_payment: true,
                offline_payment_details: { client_created_at: "client_created_at" },
                version_token: "56pRkL3slrzet2iQrTp9n0bdJVYTB9YEWdTNjQfZOPV6o",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/payments/payment_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.get({
            paymentId: "payment_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            payment: {
                id: "bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                createdAt: "2021-10-13T19:34:33.524Z",
                updatedAt: "2021-10-13T19:34:34.339Z",
                amountMoney: {
                    amount: BigInt("555"),
                    currency: "USD",
                },
                tipMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                totalMoney: {
                    amount: BigInt("555"),
                    currency: "USD",
                },
                appFeeMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                approvedMoney: {
                    amount: BigInt("555"),
                    currency: "USD",
                },
                processingFee: [
                    {
                        effectiveAt: "2021-10-13T21:34:35.000Z",
                        type: "INITIAL",
                        amountMoney: {
                            amount: BigInt("34"),
                            currency: "USD",
                        },
                    },
                ],
                refundedMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                status: "COMPLETED",
                delayDuration: "PT168H",
                delayAction: "CANCEL",
                delayedUntil: "2021-10-20T19:34:33.524Z",
                sourceType: "CARD",
                cardDetails: {
                    status: "CAPTURED",
                    card: {
                        cardBrand: "VISA",
                        last4: "1111",
                        expMonth: BigInt("11"),
                        expYear: BigInt("2022"),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        cardType: "DEBIT",
                        prepaidType: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entryMethod: "KEYED",
                    cvvStatus: "CVV_ACCEPTED",
                    avsStatus: "AVS_ACCEPTED",
                    authResultCode: "2Nkw7q",
                    applicationIdentifier: "application_identifier",
                    applicationName: "application_name",
                    applicationCryptogram: "application_cryptogram",
                    verificationMethod: "verification_method",
                    verificationResults: "verification_results",
                    statementDescription: "SQ *EXAMPLE TEST GOSQ.C",
                    cardPaymentTimeline: {
                        authorizedAt: "2021-10-13T19:34:33.680Z",
                        capturedAt: "2021-10-13T19:34:34.340Z",
                    },
                    refundRequiresCardPresence: true,
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                cashDetails: {
                    buyerSuppliedMoney: {},
                },
                bankAccountDetails: {
                    bankName: "bank_name",
                    transferType: "transfer_type",
                    accountOwnershipType: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statementDescription: "statement_description",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                externalDetails: {
                    type: "type",
                    source: "source",
                    sourceId: "source_id",
                },
                walletDetails: {
                    status: "status",
                    brand: "brand",
                },
                buyNowPayLaterDetails: {
                    brand: "brand",
                },
                squareAccountDetails: {
                    paymentSourceToken: "payment_source_token",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                locationId: "L88917AVBK2S5",
                orderId: "d7eKah653Z579f3gVtjlxpSlmUcZY",
                referenceId: "reference_id",
                customerId: "customer_id",
                employeeId: "TMoK_ogh6rH1o4dV",
                teamMemberId: "TMoK_ogh6rH1o4dV",
                refundIds: ["refund_ids"],
                riskEvaluation: {
                    createdAt: "created_at",
                    riskLevel: "PENDING",
                },
                terminalCheckoutId: "terminal_checkout_id",
                buyerEmailAddress: "buyer_email_address",
                billingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                shippingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                note: "Test Note",
                statementDescriptionIdentifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receiptNumber: "bP9m",
                receiptUrl: "https://squareup.com/receipt/preview/bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                deviceDetails: {
                    deviceId: "device_id",
                    deviceInstallationId: "device_installation_id",
                    deviceName: "device_name",
                },
                applicationDetails: {
                    squareProduct: "VIRTUAL_TERMINAL",
                    applicationId: "sq0ids-Pw67AZAlLVB7hsRmwlJPuA",
                },
                isOfflinePayment: true,
                offlinePaymentDetails: {
                    clientCreatedAt: "client_created_at",
                },
                versionToken: "56pRkL3slrzet2iQrTp9n0bdJVYTB9YEWdTNjQfZOPV6o",
            },
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            payment: {
                amount_money: { amount: BigInt(1000), currency: "USD" },
                tip_money: { amount: BigInt(100), currency: "USD" },
                version_token: "ODhwVQ35xwlzRuoZEwKXucfu7583sPTzK48c5zoGd0g6o",
            },
            idempotency_key: "956f8b13-e4ec-45d6-85e8-d1d95ef0c5de",
        };
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            payment: {
                id: "1QjqpBVyrI9S4H9sTGDWU9JeiWdZY",
                created_at: "2021-10-13T20:26:44.191Z",
                updated_at: "2021-10-13T20:26:44.364Z",
                amount_money: { amount: BigInt(1000), currency: "USD" },
                tip_money: { amount: BigInt(100), currency: "USD" },
                total_money: { amount: BigInt(1100), currency: "USD" },
                app_fee_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                approved_money: { amount: BigInt(1000), currency: "USD" },
                processing_fee: [{}],
                refunded_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                status: "APPROVED",
                delay_duration: "PT168H",
                delay_action: "CANCEL",
                delayed_until: "2021-10-20T20:26:44.191Z",
                source_type: "CARD",
                card_details: {
                    status: "AUTHORIZED",
                    card: {
                        card_brand: "VISA",
                        last_4: "1111",
                        exp_month: BigInt(11),
                        exp_year: BigInt(2022),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        card_type: "DEBIT",
                        prepaid_type: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entry_method: "ON_FILE",
                    cvv_status: "CVV_ACCEPTED",
                    avs_status: "AVS_ACCEPTED",
                    auth_result_code: "68aLBM",
                    application_identifier: "application_identifier",
                    application_name: "application_name",
                    application_cryptogram: "application_cryptogram",
                    verification_method: "verification_method",
                    verification_results: "verification_results",
                    statement_description: "SQ *EXAMPLE TEST GOSQ.C",
                    card_payment_timeline: { authorized_at: "2021-10-13T20:26:44.364Z" },
                    refund_requires_card_presence: true,
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                cash_details: { buyer_supplied_money: {} },
                bank_account_details: {
                    bank_name: "bank_name",
                    transfer_type: "transfer_type",
                    account_ownership_type: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statement_description: "statement_description",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                external_details: { type: "type", source: "source", source_id: "source_id" },
                wallet_details: { status: "status", brand: "brand" },
                buy_now_pay_later_details: { brand: "brand" },
                square_account_details: {
                    payment_source_token: "payment_source_token",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                location_id: "L88917AVBK2S5",
                order_id: "nUSN9TdxpiK3SrQg3wzmf6r8LP9YY",
                reference_id: "reference_id",
                customer_id: "W92WH6P11H4Z77CTET0RNTGFW8",
                employee_id: "employee_id",
                team_member_id: "team_member_id",
                refund_ids: ["refund_ids"],
                risk_evaluation: { created_at: "2021-10-13T20:26:45.271Z", risk_level: "NORMAL" },
                terminal_checkout_id: "terminal_checkout_id",
                buyer_email_address: "buyer_email_address",
                billing_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                shipping_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                note: "Example Note",
                statement_description_identifier: "statement_description_identifier",
                capabilities: ["EDIT_AMOUNT_UP", "EDIT_AMOUNT_DOWN", "EDIT_TIP_AMOUNT_UP", "EDIT_TIP_AMOUNT_DOWN"],
                receipt_number: "1Qjq",
                receipt_url: "receipt_url",
                device_details: {
                    device_id: "device_id",
                    device_installation_id: "device_installation_id",
                    device_name: "device_name",
                },
                application_details: {
                    square_product: "ECOMMERCE_API",
                    application_id: "sq0ids-TcgftTEtKxJTRF1lCFJ9TA",
                },
                is_offline_payment: true,
                offline_payment_details: { client_created_at: "client_created_at" },
                version_token: "rDrXnqiS7fJgexccgdpzmwqTiXui1aIKCp9EchZ7trE6o",
            },
        };
        server
            .mockEndpoint()
            .put("/v2/payments/payment_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.update({
            paymentId: "payment_id",
            payment: {
                amountMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                tipMoney: {
                    amount: BigInt("100"),
                    currency: "USD",
                },
                versionToken: "ODhwVQ35xwlzRuoZEwKXucfu7583sPTzK48c5zoGd0g6o",
            },
            idempotencyKey: "956f8b13-e4ec-45d6-85e8-d1d95ef0c5de",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            payment: {
                id: "1QjqpBVyrI9S4H9sTGDWU9JeiWdZY",
                createdAt: "2021-10-13T20:26:44.191Z",
                updatedAt: "2021-10-13T20:26:44.364Z",
                amountMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                tipMoney: {
                    amount: BigInt("100"),
                    currency: "USD",
                },
                totalMoney: {
                    amount: BigInt("1100"),
                    currency: "USD",
                },
                appFeeMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                approvedMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                processingFee: [{}],
                refundedMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                status: "APPROVED",
                delayDuration: "PT168H",
                delayAction: "CANCEL",
                delayedUntil: "2021-10-20T20:26:44.191Z",
                sourceType: "CARD",
                cardDetails: {
                    status: "AUTHORIZED",
                    card: {
                        cardBrand: "VISA",
                        last4: "1111",
                        expMonth: BigInt("11"),
                        expYear: BigInt("2022"),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        cardType: "DEBIT",
                        prepaidType: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entryMethod: "ON_FILE",
                    cvvStatus: "CVV_ACCEPTED",
                    avsStatus: "AVS_ACCEPTED",
                    authResultCode: "68aLBM",
                    applicationIdentifier: "application_identifier",
                    applicationName: "application_name",
                    applicationCryptogram: "application_cryptogram",
                    verificationMethod: "verification_method",
                    verificationResults: "verification_results",
                    statementDescription: "SQ *EXAMPLE TEST GOSQ.C",
                    cardPaymentTimeline: {
                        authorizedAt: "2021-10-13T20:26:44.364Z",
                    },
                    refundRequiresCardPresence: true,
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                cashDetails: {
                    buyerSuppliedMoney: {},
                },
                bankAccountDetails: {
                    bankName: "bank_name",
                    transferType: "transfer_type",
                    accountOwnershipType: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statementDescription: "statement_description",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                externalDetails: {
                    type: "type",
                    source: "source",
                    sourceId: "source_id",
                },
                walletDetails: {
                    status: "status",
                    brand: "brand",
                },
                buyNowPayLaterDetails: {
                    brand: "brand",
                },
                squareAccountDetails: {
                    paymentSourceToken: "payment_source_token",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                locationId: "L88917AVBK2S5",
                orderId: "nUSN9TdxpiK3SrQg3wzmf6r8LP9YY",
                referenceId: "reference_id",
                customerId: "W92WH6P11H4Z77CTET0RNTGFW8",
                employeeId: "employee_id",
                teamMemberId: "team_member_id",
                refundIds: ["refund_ids"],
                riskEvaluation: {
                    createdAt: "2021-10-13T20:26:45.271Z",
                    riskLevel: "NORMAL",
                },
                terminalCheckoutId: "terminal_checkout_id",
                buyerEmailAddress: "buyer_email_address",
                billingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                shippingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                note: "Example Note",
                statementDescriptionIdentifier: "statement_description_identifier",
                capabilities: ["EDIT_AMOUNT_UP", "EDIT_AMOUNT_DOWN", "EDIT_TIP_AMOUNT_UP", "EDIT_TIP_AMOUNT_DOWN"],
                receiptNumber: "1Qjq",
                receiptUrl: "receipt_url",
                deviceDetails: {
                    deviceId: "device_id",
                    deviceInstallationId: "device_installation_id",
                    deviceName: "device_name",
                },
                applicationDetails: {
                    squareProduct: "ECOMMERCE_API",
                    applicationId: "sq0ids-TcgftTEtKxJTRF1lCFJ9TA",
                },
                isOfflinePayment: true,
                offlinePaymentDetails: {
                    clientCreatedAt: "client_created_at",
                },
                versionToken: "rDrXnqiS7fJgexccgdpzmwqTiXui1aIKCp9EchZ7trE6o",
            },
        });
    });

    test("cancel", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            payment: {
                id: "1QjqpBVyrI9S4H9sTGDWU9JeiWdZY",
                created_at: "2021-10-13T20:26:44.191Z",
                updated_at: "2021-10-13T20:31:21.597Z",
                amount_money: { amount: BigInt(1000), currency: "USD" },
                tip_money: { amount: BigInt(100), currency: "USD" },
                total_money: { amount: BigInt(1100), currency: "USD" },
                app_fee_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                approved_money: { amount: BigInt(1000), currency: "USD" },
                processing_fee: [{}],
                refunded_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                status: "CANCELED",
                delay_duration: "PT168H",
                delay_action: "CANCEL",
                delayed_until: "2021-10-20T20:26:44.191Z",
                source_type: "CARD",
                card_details: {
                    status: "VOIDED",
                    card: {
                        card_brand: "VISA",
                        last_4: "1111",
                        exp_month: BigInt(11),
                        exp_year: BigInt(2022),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        card_type: "DEBIT",
                        prepaid_type: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entry_method: "ON_FILE",
                    cvv_status: "CVV_ACCEPTED",
                    avs_status: "AVS_ACCEPTED",
                    auth_result_code: "68aLBM",
                    application_identifier: "application_identifier",
                    application_name: "application_name",
                    application_cryptogram: "application_cryptogram",
                    verification_method: "verification_method",
                    verification_results: "verification_results",
                    statement_description: "SQ *EXAMPLE TEST GOSQ.C",
                    card_payment_timeline: {
                        authorized_at: "2021-10-13T20:26:44.364Z",
                        voided_at: "2021-10-13T20:31:21.597Z",
                    },
                    refund_requires_card_presence: true,
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                cash_details: { buyer_supplied_money: {} },
                bank_account_details: {
                    bank_name: "bank_name",
                    transfer_type: "transfer_type",
                    account_ownership_type: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statement_description: "statement_description",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                external_details: { type: "type", source: "source", source_id: "source_id" },
                wallet_details: { status: "status", brand: "brand" },
                buy_now_pay_later_details: { brand: "brand" },
                square_account_details: {
                    payment_source_token: "payment_source_token",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                location_id: "L88917AVBK2S5",
                order_id: "nUSN9TdxpiK3SrQg3wzmf6r8LP9YY",
                reference_id: "reference_id",
                customer_id: "W92WH6P11H4Z77CTET0RNTGFW8",
                employee_id: "employee_id",
                team_member_id: "team_member_id",
                refund_ids: ["refund_ids"],
                risk_evaluation: { created_at: "2021-10-13T20:26:45.271Z", risk_level: "NORMAL" },
                terminal_checkout_id: "terminal_checkout_id",
                buyer_email_address: "buyer_email_address",
                billing_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                shipping_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                note: "Example Note",
                statement_description_identifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receipt_number: "receipt_number",
                receipt_url: "receipt_url",
                device_details: {
                    device_id: "device_id",
                    device_installation_id: "device_installation_id",
                    device_name: "device_name",
                },
                application_details: {
                    square_product: "ECOMMERCE_API",
                    application_id: "sq0ids-TcgftTEtKxJTRF1lCFJ9TA",
                },
                is_offline_payment: true,
                offline_payment_details: { client_created_at: "client_created_at" },
                version_token: "N8AGYgEjCiY9Q57Jw7aVHEpBq8bzGCDCQMRX8Vs56N06o",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/payments/payment_id/cancel")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.cancel({
            paymentId: "payment_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            payment: {
                id: "1QjqpBVyrI9S4H9sTGDWU9JeiWdZY",
                createdAt: "2021-10-13T20:26:44.191Z",
                updatedAt: "2021-10-13T20:31:21.597Z",
                amountMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                tipMoney: {
                    amount: BigInt("100"),
                    currency: "USD",
                },
                totalMoney: {
                    amount: BigInt("1100"),
                    currency: "USD",
                },
                appFeeMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                approvedMoney: {
                    amount: BigInt("1000"),
                    currency: "USD",
                },
                processingFee: [{}],
                refundedMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                status: "CANCELED",
                delayDuration: "PT168H",
                delayAction: "CANCEL",
                delayedUntil: "2021-10-20T20:26:44.191Z",
                sourceType: "CARD",
                cardDetails: {
                    status: "VOIDED",
                    card: {
                        cardBrand: "VISA",
                        last4: "1111",
                        expMonth: BigInt("11"),
                        expYear: BigInt("2022"),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        cardType: "DEBIT",
                        prepaidType: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entryMethod: "ON_FILE",
                    cvvStatus: "CVV_ACCEPTED",
                    avsStatus: "AVS_ACCEPTED",
                    authResultCode: "68aLBM",
                    applicationIdentifier: "application_identifier",
                    applicationName: "application_name",
                    applicationCryptogram: "application_cryptogram",
                    verificationMethod: "verification_method",
                    verificationResults: "verification_results",
                    statementDescription: "SQ *EXAMPLE TEST GOSQ.C",
                    cardPaymentTimeline: {
                        authorizedAt: "2021-10-13T20:26:44.364Z",
                        voidedAt: "2021-10-13T20:31:21.597Z",
                    },
                    refundRequiresCardPresence: true,
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                cashDetails: {
                    buyerSuppliedMoney: {},
                },
                bankAccountDetails: {
                    bankName: "bank_name",
                    transferType: "transfer_type",
                    accountOwnershipType: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statementDescription: "statement_description",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                externalDetails: {
                    type: "type",
                    source: "source",
                    sourceId: "source_id",
                },
                walletDetails: {
                    status: "status",
                    brand: "brand",
                },
                buyNowPayLaterDetails: {
                    brand: "brand",
                },
                squareAccountDetails: {
                    paymentSourceToken: "payment_source_token",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                locationId: "L88917AVBK2S5",
                orderId: "nUSN9TdxpiK3SrQg3wzmf6r8LP9YY",
                referenceId: "reference_id",
                customerId: "W92WH6P11H4Z77CTET0RNTGFW8",
                employeeId: "employee_id",
                teamMemberId: "team_member_id",
                refundIds: ["refund_ids"],
                riskEvaluation: {
                    createdAt: "2021-10-13T20:26:45.271Z",
                    riskLevel: "NORMAL",
                },
                terminalCheckoutId: "terminal_checkout_id",
                buyerEmailAddress: "buyer_email_address",
                billingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                shippingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                note: "Example Note",
                statementDescriptionIdentifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receiptNumber: "receipt_number",
                receiptUrl: "receipt_url",
                deviceDetails: {
                    deviceId: "device_id",
                    deviceInstallationId: "device_installation_id",
                    deviceName: "device_name",
                },
                applicationDetails: {
                    squareProduct: "ECOMMERCE_API",
                    applicationId: "sq0ids-TcgftTEtKxJTRF1lCFJ9TA",
                },
                isOfflinePayment: true,
                offlinePaymentDetails: {
                    clientCreatedAt: "client_created_at",
                },
                versionToken: "N8AGYgEjCiY9Q57Jw7aVHEpBq8bzGCDCQMRX8Vs56N06o",
            },
        });
    });

    test("complete", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ token: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            payment: {
                id: "bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                created_at: "2021-10-13T19:34:33.524Z",
                updated_at: "2021-10-13T19:34:34.339Z",
                amount_money: { amount: BigInt(555), currency: "USD" },
                tip_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                total_money: { amount: BigInt(555), currency: "USD" },
                app_fee_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                approved_money: { amount: BigInt(555), currency: "USD" },
                processing_fee: [
                    {
                        effective_at: "2021-10-13T21:34:35.000Z",
                        type: "INITIAL",
                        amount_money: { amount: BigInt(34), currency: "USD" },
                    },
                ],
                refunded_money: { amount: BigInt(1000000), currency: "UNKNOWN_CURRENCY" },
                status: "COMPLETED",
                delay_duration: "PT168H",
                delay_action: "CANCEL",
                delayed_until: "2021-10-20T19:34:33.524Z",
                source_type: "CARD",
                card_details: {
                    status: "CAPTURED",
                    card: {
                        card_brand: "VISA",
                        last_4: "1111",
                        exp_month: BigInt(11),
                        exp_year: BigInt(2022),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        card_type: "DEBIT",
                        prepaid_type: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entry_method: "KEYED",
                    cvv_status: "CVV_ACCEPTED",
                    avs_status: "AVS_ACCEPTED",
                    auth_result_code: "2Nkw7q",
                    application_identifier: "application_identifier",
                    application_name: "application_name",
                    application_cryptogram: "application_cryptogram",
                    verification_method: "verification_method",
                    verification_results: "verification_results",
                    statement_description: "SQ *EXAMPLE TEST GOSQ.C",
                    card_payment_timeline: {
                        authorized_at: "2021-10-13T19:34:33.680Z",
                        captured_at: "2021-10-13T19:34:34.340Z",
                    },
                    refund_requires_card_presence: true,
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                cash_details: { buyer_supplied_money: {} },
                bank_account_details: {
                    bank_name: "bank_name",
                    transfer_type: "transfer_type",
                    account_ownership_type: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statement_description: "statement_description",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                external_details: { type: "type", source: "source", source_id: "source_id" },
                wallet_details: { status: "status", brand: "brand" },
                buy_now_pay_later_details: { brand: "brand" },
                square_account_details: {
                    payment_source_token: "payment_source_token",
                    errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR" }],
                },
                location_id: "L88917AVBK2S5",
                order_id: "d7eKah653Z579f3gVtjlxpSlmUcZY",
                reference_id: "reference_id",
                customer_id: "customer_id",
                employee_id: "TMoK_ogh6rH1o4dV",
                team_member_id: "TMoK_ogh6rH1o4dV",
                refund_ids: ["refund_ids"],
                risk_evaluation: { created_at: "created_at", risk_level: "PENDING" },
                terminal_checkout_id: "terminal_checkout_id",
                buyer_email_address: "buyer_email_address",
                billing_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                shipping_address: {
                    address_line_1: "address_line_1",
                    address_line_2: "address_line_2",
                    address_line_3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality_2: "sublocality_2",
                    sublocality_3: "sublocality_3",
                    administrative_district_level_1: "administrative_district_level_1",
                    administrative_district_level_2: "administrative_district_level_2",
                    administrative_district_level_3: "administrative_district_level_3",
                    postal_code: "postal_code",
                    country: "ZZ",
                    first_name: "first_name",
                    last_name: "last_name",
                },
                note: "Test Note",
                statement_description_identifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receipt_number: "bP9m",
                receipt_url: "https://squareup.com/receipt/preview/bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                device_details: {
                    device_id: "device_id",
                    device_installation_id: "device_installation_id",
                    device_name: "device_name",
                },
                application_details: {
                    square_product: "VIRTUAL_TERMINAL",
                    application_id: "sq0ids-Pw67AZAlLVB7hsRmwlJPuA",
                },
                is_offline_payment: true,
                offline_payment_details: { client_created_at: "client_created_at" },
                version_token: "56pRkL3slrzet2iQrTp9n0bdJVYTB9YEWdTNjQfZOPV6o",
            },
        };
        server
            .mockEndpoint()
            .post("/v2/payments/payment_id/complete")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.complete({
            paymentId: "payment_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            payment: {
                id: "bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                createdAt: "2021-10-13T19:34:33.524Z",
                updatedAt: "2021-10-13T19:34:34.339Z",
                amountMoney: {
                    amount: BigInt("555"),
                    currency: "USD",
                },
                tipMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                totalMoney: {
                    amount: BigInt("555"),
                    currency: "USD",
                },
                appFeeMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                approvedMoney: {
                    amount: BigInt("555"),
                    currency: "USD",
                },
                processingFee: [
                    {
                        effectiveAt: "2021-10-13T21:34:35.000Z",
                        type: "INITIAL",
                        amountMoney: {
                            amount: BigInt("34"),
                            currency: "USD",
                        },
                    },
                ],
                refundedMoney: {
                    amount: BigInt("1000000"),
                    currency: "UNKNOWN_CURRENCY",
                },
                status: "COMPLETED",
                delayDuration: "PT168H",
                delayAction: "CANCEL",
                delayedUntil: "2021-10-20T19:34:33.524Z",
                sourceType: "CARD",
                cardDetails: {
                    status: "CAPTURED",
                    card: {
                        cardBrand: "VISA",
                        last4: "1111",
                        expMonth: BigInt("11"),
                        expYear: BigInt("2022"),
                        fingerprint: "sq-1-Hxim77tbdcbGejOejnoAklBVJed2YFLTmirfl8Q5XZzObTc8qY_U8RkwzoNL8dCEcQ",
                        cardType: "DEBIT",
                        prepaidType: "NOT_PREPAID",
                        bin: "411111",
                    },
                    entryMethod: "KEYED",
                    cvvStatus: "CVV_ACCEPTED",
                    avsStatus: "AVS_ACCEPTED",
                    authResultCode: "2Nkw7q",
                    applicationIdentifier: "application_identifier",
                    applicationName: "application_name",
                    applicationCryptogram: "application_cryptogram",
                    verificationMethod: "verification_method",
                    verificationResults: "verification_results",
                    statementDescription: "SQ *EXAMPLE TEST GOSQ.C",
                    cardPaymentTimeline: {
                        authorizedAt: "2021-10-13T19:34:33.680Z",
                        capturedAt: "2021-10-13T19:34:34.340Z",
                    },
                    refundRequiresCardPresence: true,
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                cashDetails: {
                    buyerSuppliedMoney: {},
                },
                bankAccountDetails: {
                    bankName: "bank_name",
                    transferType: "transfer_type",
                    accountOwnershipType: "account_ownership_type",
                    fingerprint: "fingerprint",
                    country: "country",
                    statementDescription: "statement_description",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                externalDetails: {
                    type: "type",
                    source: "source",
                    sourceId: "source_id",
                },
                walletDetails: {
                    status: "status",
                    brand: "brand",
                },
                buyNowPayLaterDetails: {
                    brand: "brand",
                },
                squareAccountDetails: {
                    paymentSourceToken: "payment_source_token",
                    errors: [
                        {
                            category: "API_ERROR",
                            code: "INTERNAL_SERVER_ERROR",
                        },
                    ],
                },
                locationId: "L88917AVBK2S5",
                orderId: "d7eKah653Z579f3gVtjlxpSlmUcZY",
                referenceId: "reference_id",
                customerId: "customer_id",
                employeeId: "TMoK_ogh6rH1o4dV",
                teamMemberId: "TMoK_ogh6rH1o4dV",
                refundIds: ["refund_ids"],
                riskEvaluation: {
                    createdAt: "created_at",
                    riskLevel: "PENDING",
                },
                terminalCheckoutId: "terminal_checkout_id",
                buyerEmailAddress: "buyer_email_address",
                billingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                shippingAddress: {
                    addressLine1: "address_line_1",
                    addressLine2: "address_line_2",
                    addressLine3: "address_line_3",
                    locality: "locality",
                    sublocality: "sublocality",
                    sublocality2: "sublocality_2",
                    sublocality3: "sublocality_3",
                    administrativeDistrictLevel1: "administrative_district_level_1",
                    administrativeDistrictLevel2: "administrative_district_level_2",
                    administrativeDistrictLevel3: "administrative_district_level_3",
                    postalCode: "postal_code",
                    country: "ZZ",
                    firstName: "first_name",
                    lastName: "last_name",
                },
                note: "Test Note",
                statementDescriptionIdentifier: "statement_description_identifier",
                capabilities: ["capabilities"],
                receiptNumber: "bP9m",
                receiptUrl: "https://squareup.com/receipt/preview/bP9mAsEMYPUGjjGNaNO5ZDVyLhSZY",
                deviceDetails: {
                    deviceId: "device_id",
                    deviceInstallationId: "device_installation_id",
                    deviceName: "device_name",
                },
                applicationDetails: {
                    squareProduct: "VIRTUAL_TERMINAL",
                    applicationId: "sq0ids-Pw67AZAlLVB7hsRmwlJPuA",
                },
                isOfflinePayment: true,
                offlinePaymentDetails: {
                    clientCreatedAt: "client_created_at",
                },
                versionToken: "56pRkL3slrzet2iQrTp9n0bdJVYTB9YEWdTNjQfZOPV6o",
            },
        });
    });
});
