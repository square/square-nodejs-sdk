// This file was auto-generated by Fern from our API Definition.

import { SquareClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("DevicesClient", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            devices: [
                {
                    id: "device:995CS397A6475287",
                    attributes: {
                        type: "TERMINAL",
                        manufacturer: "Square",
                        model: "Square Terminal (1st Gen, v2)",
                        name: "Square Terminal 5287",
                        manufacturers_id: "995CS397A6475287",
                        updated_at: "2025-08-19T13:04:56.335762883Z",
                        version: "5.57.0067",
                        merchant_token: "MLCHNZCBWFDZB",
                    },
                    components: [
                        {
                            type: "APPLICATION",
                            application_details: {
                                application_type: "TERMINAL_API",
                                version: "6.77",
                                session_location: "LMN2K7S3RTOU3",
                            },
                        },
                        { type: "CARD_READER", card_reader_details: { version: "4.1.51" } },
                        {
                            type: "BATTERY",
                            battery_details: { visible_percent: 77, external_power: "AVAILABLE_CHARGING" },
                        },
                        {
                            type: "WIFI",
                            wifi_details: {
                                active: true,
                                ssid: "Staff Network",
                                ip_address_v4: "10.0.0.7",
                                secure_connection: "WPA/WPA2 PSK",
                                signal_strength: { value: 2 },
                            },
                        },
                        { type: "ETHERNET", ethernet_details: { active: false } },
                    ],
                    status: { category: "AVAILABLE" },
                },
                {
                    id: "device:998WS21803L03559",
                    attributes: {
                        type: "HANDHELD",
                        manufacturer: "Square",
                        model: "Square Handheld (1st Gen, v1)",
                        name: "Square Terminal 3559",
                        manufacturers_id: "998WS21803L03559",
                        updated_at: "2025-08-19T12:39:56.335742073Z",
                        version: "7.21.0017",
                        merchant_token: "MLCHXZCBWFGDW",
                    },
                    components: [
                        {
                            type: "APPLICATION",
                            application_details: {
                                application_type: "TERMINAL_API",
                                version: "6.77",
                                session_location: "LMN2K7S3RTOU3",
                            },
                        },
                        { type: "CARD_READER", card_reader_details: { version: "4.5.58" } },
                        {
                            type: "BATTERY",
                            battery_details: { visible_percent: 22, external_power: "AVAILABLE_CHARGING" },
                        },
                        {
                            type: "WIFI",
                            wifi_details: {
                                active: true,
                                ssid: "Staff Network",
                                ip_address_v4: "10.0.0.7",
                                secure_connection: "WPA/WPA2 PSK",
                                signal_strength: { value: 2 },
                            },
                        },
                        { type: "ETHERNET", ethernet_details: { active: false } },
                    ],
                    status: { category: "NEEDS_ATTENTION" },
                },
            ],
            cursor: "GcXjlV2iaizH7R0fMT6wUDbw6l4otigjzx8XOOspUKHo9EPLRByM",
        };
        server
            .mockEndpoint({ once: false })
            .get("/v2/devices")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const expected = {
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            devices: [
                {
                    id: "device:995CS397A6475287",
                    attributes: {
                        type: "TERMINAL",
                        manufacturer: "Square",
                        model: "Square Terminal (1st Gen, v2)",
                        name: "Square Terminal 5287",
                        manufacturersId: "995CS397A6475287",
                        updatedAt: "2025-08-19T13:04:56.335762883Z",
                        version: "5.57.0067",
                        merchantToken: "MLCHNZCBWFDZB",
                    },
                    components: [
                        {
                            type: "APPLICATION",
                            applicationDetails: {
                                applicationType: "TERMINAL_API",
                                version: "6.77",
                                sessionLocation: "LMN2K7S3RTOU3",
                            },
                        },
                        {
                            type: "CARD_READER",
                            cardReaderDetails: {
                                version: "4.1.51",
                            },
                        },
                        {
                            type: "BATTERY",
                            batteryDetails: {
                                visiblePercent: 77,
                                externalPower: "AVAILABLE_CHARGING",
                            },
                        },
                        {
                            type: "WIFI",
                            wifiDetails: {
                                active: true,
                                ssid: "Staff Network",
                                ipAddressV4: "10.0.0.7",
                                secureConnection: "WPA/WPA2 PSK",
                                signalStrength: {
                                    value: 2,
                                },
                            },
                        },
                        {
                            type: "ETHERNET",
                            ethernetDetails: {
                                active: false,
                            },
                        },
                    ],
                    status: {
                        category: "AVAILABLE",
                    },
                },
                {
                    id: "device:998WS21803L03559",
                    attributes: {
                        type: "HANDHELD",
                        manufacturer: "Square",
                        model: "Square Handheld (1st Gen, v1)",
                        name: "Square Terminal 3559",
                        manufacturersId: "998WS21803L03559",
                        updatedAt: "2025-08-19T12:39:56.335742073Z",
                        version: "7.21.0017",
                        merchantToken: "MLCHXZCBWFGDW",
                    },
                    components: [
                        {
                            type: "APPLICATION",
                            applicationDetails: {
                                applicationType: "TERMINAL_API",
                                version: "6.77",
                                sessionLocation: "LMN2K7S3RTOU3",
                            },
                        },
                        {
                            type: "CARD_READER",
                            cardReaderDetails: {
                                version: "4.5.58",
                            },
                        },
                        {
                            type: "BATTERY",
                            batteryDetails: {
                                visiblePercent: 22,
                                externalPower: "AVAILABLE_CHARGING",
                            },
                        },
                        {
                            type: "WIFI",
                            wifiDetails: {
                                active: true,
                                ssid: "Staff Network",
                                ipAddressV4: "10.0.0.7",
                                secureConnection: "WPA/WPA2 PSK",
                                signalStrength: {
                                    value: 2,
                                },
                            },
                        },
                        {
                            type: "ETHERNET",
                            ethernetDetails: {
                                active: false,
                            },
                        },
                    ],
                    status: {
                        category: "NEEDS_ATTENTION",
                    },
                },
            ],
            cursor: "GcXjlV2iaizH7R0fMT6wUDbw6l4otigjzx8XOOspUKHo9EPLRByM",
        };
        const page = await client.devices.list({
            cursor: "cursor",
            sortOrder: "DESC",
            limit: 1,
            locationId: "location_id",
        });

        expect(expected.devices).toEqual(page.data);
        expect(page.hasNextPage()).toBe(true);
        const nextPage = await page.getNextPage();
        expect(expected.devices).toEqual(nextPage.data);
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new SquareClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [{ category: "API_ERROR", code: "INTERNAL_SERVER_ERROR", detail: "detail", field: "field" }],
            device: {
                id: "device:995CS397A6475287",
                attributes: {
                    type: "TERMINAL",
                    manufacturer: "Square",
                    model: "T2",
                    name: "Square Terminal 995",
                    manufacturers_id: "995CS397A6475287",
                    updated_at: "2023-09-29T13:12:22.365049321Z",
                    version: "5.41.0085",
                    merchant_token: "MLCHXZCBWFGDW",
                },
                components: [
                    {
                        type: "APPLICATION",
                        application_details: {
                            application_type: "TERMINAL_API",
                            version: "6.25",
                            session_location: "LMN2K7S3RTOU3",
                        },
                    },
                    { type: "CARD_READER", card_reader_details: { version: "3.53.70" } },
                    { type: "BATTERY", battery_details: { visible_percent: 5, external_power: "AVAILABLE_CHARGING" } },
                    {
                        type: "WIFI",
                        wifi_details: {
                            active: true,
                            ssid: "Staff Network",
                            ip_address_v4: "10.0.0.7",
                            secure_connection: "WPA/WPA2 PSK",
                            signal_strength: { value: 2 },
                        },
                    },
                    { type: "ETHERNET", ethernet_details: { active: false } },
                ],
                status: { category: "AVAILABLE" },
            },
        };
        server
            .mockEndpoint()
            .get("/v2/devices/device_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.devices.get({
            deviceId: "device_id",
        });
        expect(response).toEqual({
            errors: [
                {
                    category: "API_ERROR",
                    code: "INTERNAL_SERVER_ERROR",
                    detail: "detail",
                    field: "field",
                },
            ],
            device: {
                id: "device:995CS397A6475287",
                attributes: {
                    type: "TERMINAL",
                    manufacturer: "Square",
                    model: "T2",
                    name: "Square Terminal 995",
                    manufacturersId: "995CS397A6475287",
                    updatedAt: "2023-09-29T13:12:22.365049321Z",
                    version: "5.41.0085",
                    merchantToken: "MLCHXZCBWFGDW",
                },
                components: [
                    {
                        type: "APPLICATION",
                        applicationDetails: {
                            applicationType: "TERMINAL_API",
                            version: "6.25",
                            sessionLocation: "LMN2K7S3RTOU3",
                        },
                    },
                    {
                        type: "CARD_READER",
                        cardReaderDetails: {
                            version: "3.53.70",
                        },
                    },
                    {
                        type: "BATTERY",
                        batteryDetails: {
                            visiblePercent: 5,
                            externalPower: "AVAILABLE_CHARGING",
                        },
                    },
                    {
                        type: "WIFI",
                        wifiDetails: {
                            active: true,
                            ssid: "Staff Network",
                            ipAddressV4: "10.0.0.7",
                            secureConnection: "WPA/WPA2 PSK",
                            signalStrength: {
                                value: 2,
                            },
                        },
                    },
                    {
                        type: "ETHERNET",
                        ethernetDetails: {
                            active: false,
                        },
                    },
                ],
                status: {
                    category: "AVAILABLE",
                },
            },
        });
    });
});
